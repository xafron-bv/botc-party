<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Blood on the Clocktower - Party Grimoire</title>
  <link rel="stylesheet" href="assets/fontawesome/css/all.min.css">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="styles/day-night-tracking.css">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="assets/icons/android-chrome-192x192.png">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#583286">
</head>
<body>
  <div id="app">
    <div id="sidebar">
      <button class="button sidebar-close" id="sidebar-close" aria-label="Close sidebar">Close Sidebar</button>
      <div class="section">
        <h3>Game Setup</h3>
        <div>
          <label for="player-count">Player Count:</label>
          <input type="number" id="player-count" min="5" max="20">
        </div>
        <button class="button" id="start-game">Start Game</button>
        <div id="game-status" class="status" aria-live="polite"></div>
      </div>

      <div class="section">
        <h3>Script Management</h3>
        <div class="script-buttons">
          <button class="button" id="load-tb">Trouble Brewing</button>
          <button class="button" id="load-bmr">Bad Moon Rising</button>
          <button class="button" id="load-sav">Sects &amp; Violets</button>
          <button class="button" id="load-all-chars">Load All Characters</button>
        </div>
        <div id="load-status" aria-live="polite"></div>
        <div style="margin-top: 15px;">
          <label for="script-file">Or Upload Custom Script:</label>
          <input type="file" id="script-file" accept=".json">
        </div>
        <div style="margin-top: 15px;">
          <h3>Script History</h3>
          <ul id="script-history-list" class="history-list"></ul>
        </div>
      </div>

      <div class="section">
        <h3>Background</h3>
        <div>
          <select id="background-select">
            <option value="none">No background</option>
            <option value="background4-C7TzDZ7M.webp">Default Background</option>
            <option value="background4-X8jQb4tv.webp">Background 1</option>
            <option value="background-bJ1INm6Z.webp">Background 2</option>
          </select>
        </div>
      </div>
      <div class="section">
        <h3>Character Sheet</h3>
        <div style="margin-bottom: 8px;">
          <label><input type="checkbox" id="include-travellers"> Include Travellers</label>
        </div>
        <div id="character-sheet">
          <p>Load a script to see available characters.</p>
        </div>
      </div>
      <div class="section">
        <h3>Grimoire History</h3>
        <ul id="grimoire-history-list" class="history-list"></ul>
      </div>
      <div class="section">
        <h3>Tutorial</h3>
        <div id="tutorial-sidebar-content">
          <p>Quick tour: set players, load a script, assign characters, add reminders.</p>
          <button class="button" id="start-tour">Start Tutorial</button>
        </div>
      </div>
      <div class="section">
        <a class="button" href="terms.html">Terms of Use</a>
      </div>
    </div>
    <div id="sidebar-resizer" aria-label="Resize sidebar" role="separator"></div>

    <div id="grimoire">
      <button id="sidebar-toggle" class="button sidebar-toggle" aria-label="Toggle sidebar" aria-pressed="false">Close Sidebar</button>
      <button id="day-night-toggle" data-testid="day-night-toggle" class="button day-night-toggle" aria-label="Toggle day/night tracking" aria-pressed="false" title="Toggle day/night tracking">
        <i class="fas fa-moon"></i>
      </button>
      <div class="sidebar-backdrop" id="sidebar-backdrop" aria-hidden="true"></div>
      <div id="center">
        <div id="setup-info" aria-live="polite"></div>
        <ul id="player-circle" class="circle"></ul>
      </div>
      <div id="day-night-slider" data-testid="day-night-slider" class="day-night-slider">
        <div class="slider-container">
          <div id="phase-labels" data-testid="phase-labels" class="phase-labels"></div>
          <input type="range" min="0" max="0" value="0" class="phase-slider" id="phase-slider">
          <div id="current-phase" data-testid="current-phase" class="current-phase">N1</div>
          <button id="add-phase-button" data-testid="add-phase-button" class="add-phase-button" aria-label="Add next phase">+</button>
        </div>
      </div>
    </div>
  </div>

  <div id="character-modal" class="modal">
    <div class="modal-content">
      <h3>Select Character for <span id="character-modal-player-name"></span></h3>
      <input type="text" id="character-search" placeholder="Search characters...">
      <div id="character-grid"></div>
      <button class="button" id="close-character-modal">Cancel</button>
    </div>
  </div>

  <div id="text-reminder-modal" class="modal">
    <div class="modal-content">
      <h3>Add/Edit Reminder</h3>
      <input type="text" id="reminder-text-input" placeholder="Enter reminder text...">
      <button class="button" id="save-reminder-btn" data-testid="save-text-reminder">Save</button>
      <button class="button" id="cancel-reminder-btn">Cancel</button>
    </div>
  </div>
  
    <div id="reminder-token-modal" class="modal">
    <div class="modal-content">
      <h3>Select Reminder Token for <span id="reminder-token-modal-player-name"></span></h3>
      <input type="text" id="reminder-token-search" placeholder="Search tokens or characters...">
      <div id="reminder-token-grid"></div>
      <button class="button" id="close-reminder-token-modal">Cancel</button>
    </div>
  </div>

  <!-- Ability tooltip for hover -->
  <div id="ability-tooltip" class="ability-tooltip"></div>
  
  <!-- Touch ability popup -->
  <div id="touch-ability-popup" class="touch-ability-popup"></div>

  <script type="module" src="script.js"></script>
</body>
</html>
